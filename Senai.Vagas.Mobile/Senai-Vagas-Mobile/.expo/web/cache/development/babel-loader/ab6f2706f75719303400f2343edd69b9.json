{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\senai\\\\Desktop\\\\Senai.Vagas.Mobile\\\\Senai-Vagas-Mobile\\\\src\\\\context\\\\auth.tsx\";\n\nimport React, { createContext, useState, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport jwt from \"../services/tokenDecoder\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLogged = _useState2[0],\n      setIsLogged = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isCandidato = _useState4[0],\n      setIsCandidato = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isEmpresa = _useState6[0],\n      setIsEmpresa = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isAdmin = _useState8[0],\n      setIsAdmin = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      tokenDecoded = _useState10[0],\n      setTokenDecoded = _useState10[1];\n\n  var _useState11 = useState(''),\n      _useState12 = _slicedToArray(_useState11, 2),\n      email = _useState12[0],\n      setEmail = _useState12[1];\n\n  var _useState13 = useState(''),\n      _useState14 = _slicedToArray(_useState13, 2),\n      senha = _useState14[0],\n      setSenha = _useState14[1];\n\n  var _useState15 = useState(true),\n      _useState16 = _slicedToArray(_useState15, 2),\n      isLoading = _useState16[0],\n      setIsLoading = _useState16[1];\n\n  useEffect(function () {\n    Logged();\n  }, []);\n\n  var Logged = function Logged() {\n    var response;\n    return _regeneratorRuntime.async(function Logged$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('token-usuario'));\n\n          case 2:\n            response = _context.sent;\n            userLogged(response);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var userLogged = function userLogged(response) {\n    var _tokenDecoded;\n\n    return _regeneratorRuntime.async(function userLogged$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!response) {\n              setIsLogged(false);\n              setIsAdmin(false);\n              setIsCandidato(false);\n              setIsEmpresa(false);\n              setIsLoading(false);\n            } else {\n              setIsLogged(true);\n              _tokenDecoded = jwt(response);\n\n              if ((_tokenDecoded == null ? void 0 : _tokenDecoded.role) === \"Administrador\") {\n                setIsAdmin(true), setIsCandidato(false), setIsEmpresa(false);\n              } else if ((_tokenDecoded == null ? void 0 : _tokenDecoded.role) === \"Candidato\") {\n                setIsAdmin(false), setIsCandidato(true), setIsEmpresa(false);\n              } else if ((_tokenDecoded == null ? void 0 : _tokenDecoded.role) === \"Empresa\") {\n                setIsAdmin(false), setIsCandidato(false), setIsEmpresa(true);\n              }\n\n              console.log(_tokenDecoded);\n            }\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var SignIn = function SignIn(form) {\n    var init;\n    return _regeneratorRuntime.async(function SignIn$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            init = {\n              method: 'post',\n              headers: {\n                'Content-Type': 'application/json'\n              },\n              body: JSON.stringify(form)\n            };\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(fetch('http://wolfrosfay4-001-site1.btempurl.com/api/login', init).then(function (resp) {\n              return resp.json();\n            }).then(function (data) {\n              if (data.token !== undefined) {\n                AsyncStorage.setItem('token-usuario', data.token);\n                setIsLogged(data.token);\n              } else {\n                setIsLogged(false);\n                setIsAdmin(false);\n                setIsCandidato(false);\n                setIsEmpresa(false);\n                Alert.alert(data);\n              }\n            }).catch(function (error) {\n              console.log('ERROR in SignIn: ' + error.message);\n            }));\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var SignOut = function SignOut() {\n    return _regeneratorRuntime.async(function SignOut$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.clear().then(function () {\n              setIsLogged(false);\n              setIsAdmin(false);\n              setIsCandidato(false);\n              setIsEmpresa(false);\n              setTokenDecoded(null);\n            }));\n\n          case 2:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      logged: isLogged,\n      IsAdmin: isAdmin,\n      IsCandidato: isCandidato,\n      IsEmpresa: isEmpresa,\n      IsLoading: isLoading,\n      token: tokenDecoded,\n      SignIn: SignIn,\n      SignOut: SignOut\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }\n  }, children);\n};\nexport default AuthContext;","map":{"version":3,"sources":["C:/Users/senai/Desktop/Senai.Vagas.Mobile/Senai-Vagas-Mobile/src/context/auth.tsx"],"names":["React","createContext","useState","useEffect","AsyncStorage","jwt","AuthContext","AuthProvider","children","isLogged","setIsLogged","isCandidato","setIsCandidato","isEmpresa","setIsEmpresa","isAdmin","setIsAdmin","tokenDecoded","setTokenDecoded","email","setEmail","senha","setSenha","isLoading","setIsLoading","Logged","getItem","response","userLogged","role","console","log","SignIn","form","init","method","headers","body","JSON","stringify","fetch","then","resp","json","data","token","undefined","setItem","Alert","alert","catch","error","message","SignOut","clear","logged","IsAdmin","IsCandidato","IsEmpresa","IsLoading"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\n\r\n// AsyncStorage (\"localStorage\" do react native)\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\n// Token Decoder Service\r\nimport jwt from '../services/tokenDecoder';\r\n\r\n//importacao da api\r\nimport api from '../services/api';\r\n\r\n// Interfaces\r\nimport LoginProps from '../interfaces/login';\r\n\r\n// Outras bibliotecas\r\nimport { Alert } from 'react-native';\r\n\r\n\r\ninterface AuthContextData {\r\n    logged: boolean,\r\n    IsCandidato: boolean,\r\n    IsEmpresa: boolean,\r\n    IsAdmin: boolean,\r\n    IsLoading: boolean,\r\n    token: object | null,\r\n    SignIn(form: LoginProps): Promise<void>,\r\n    SignOut(): Promise<void>,\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\r\n\r\n// Exportando AuthProvider para se rusado no routes\r\nexport const AuthProvider: React.FC = ({ children }: any) => {\r\n    const [isLogged, setIsLogged] = useState(false);\r\n    const [isCandidato, setIsCandidato] = useState(false);\r\n    const [isEmpresa, setIsEmpresa] = useState(false);\r\n    const [isAdmin, setIsAdmin] = useState(false);\r\n    const [tokenDecoded, setTokenDecoded] = useState<object | null>(null);\r\n\r\n    const [email, setEmail] = useState('');\r\n    const [senha, setSenha] = useState('');\r\n\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        Logged();\r\n    }, []);\r\n\r\n    // Função assíncrona para adquirir atributo que esta guardado no \"AsyncStorage\"\r\n    const Logged = async () => {\r\n        const response = await AsyncStorage.getItem('token-usuario');\r\n        userLogged(response);\r\n    }\r\n\r\n    const userLogged = async (response: any) => {\r\n\r\n        // Muda o estado de 'isLogged' caso usuário esteja ou não autenticado\r\n        if (!response) {\r\n            setIsLogged(false)\r\n            setIsAdmin(false)\r\n            setIsCandidato(false)\r\n            setIsEmpresa(false)\r\n            setIsLoading(false)\r\n        }\r\n        else {\r\n            setIsLogged(true)\r\n\r\n            // Token Decoder\r\n            let tokenDecoded = jwt(response);\r\n\r\n            // Muda o estado dos tipos de usuario (boolean) dependendo da 'role' do usuário\r\n            if (tokenDecoded?.role === \"Administrador\") {\r\n                (setIsAdmin(true), setIsCandidato(false), setIsEmpresa(false));\r\n            }\r\n\r\n            else if (tokenDecoded?.role === \"Candidato\") {\r\n                (setIsAdmin(false), setIsCandidato(true), setIsEmpresa(false));\r\n            }\r\n\r\n            else if (tokenDecoded?.role === \"Empresa\") {\r\n                (setIsAdmin(false), setIsCandidato(false), setIsEmpresa(true));\r\n            }\r\n            console.log(tokenDecoded)\r\n        }\r\n    }\r\n\r\n    const SignIn = async (form: LoginProps) => {\r\n        const init = {\r\n            method: 'post',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify(form),\r\n        };\r\n\r\n        // Se você estiver executando o servidor e o emulador em seu computador, 127.0.0.1:(port) fará referência ao emulador em si e não ao servidor.\r\n        // O 10.0.2.2 é a solução para esse problema \r\n        // (atualmente utilizando o IP da maquina para aplicação mobile com EXPO)\r\n        await fetch('http://wolfrosfay4-001-site1.btempurl.com/api/login', init)\r\n            .then(resp => resp.json())\r\n            .then(data => {\r\n                // Verifica se a propriedade token é diferente de indefinida (se a propriedade existe no retorno do json)\r\n                if (data.token !== undefined) {\r\n                    AsyncStorage.setItem('token-usuario', data.token);\r\n                    setIsLogged(data.token);\r\n                }\r\n                else {\r\n                    // Erro caso email ou senha sejam inválidos\r\n                    setIsLogged(false);\r\n                    setIsAdmin(false);\r\n                    setIsCandidato(false);\r\n                    setIsEmpresa(false);\r\n\r\n                    // Retorna para a tela de Login o erro do backend\r\n                    Alert.alert(data);\r\n                }\r\n            })\r\n            .catch(error => {\r\n                console.log('ERROR in SignIn: ' + error.message);\r\n            });\r\n    }\r\n\r\n    const SignOut = async () => {\r\n        await AsyncStorage.clear()\r\n            .then(() => {\r\n                setIsLogged(false);\r\n                setIsAdmin(false);\r\n                setIsCandidato(false);\r\n                setIsEmpresa(false);\r\n                setTokenDecoded(null);\r\n            })\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ logged: isLogged, IsAdmin: isAdmin, IsCandidato: isCandidato, IsEmpresa: isEmpresa, IsLoading: isLoading, token: tokenDecoded, SignIn, SignOut }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport default AuthContext;"]},"metadata":{},"sourceType":"module"}